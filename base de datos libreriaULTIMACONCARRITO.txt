CREATE TABLE cliente (
    rut_cliente     VARCHAR2(15) NOT NULL,
    nombre          VARCHAR2(50) NOT NULL,
    apellido        VARCHAR2(50) NOT NULL,
    correo          VARCHAR2(80) NOT NULL,
    direccion       VARCHAR2(80),
    telefono        NUMBER(10),
    numero_tarjeta  NUMBER(10) NOT NULL
);

ALTER TABLE cliente ADD CONSTRAINT cliente_pk PRIMARY KEY ( rut_cliente );

CREATE TABLE tecnico (
    rut_tecnico  VARCHAR2(15) NOT NULL,
    nombre       VARCHAR2(50) NOT NULL,
    apellido     VARCHAR2(50) NOT NULL,
    correo       VARCHAR2(80) NOT NULL,
    direccion    VARCHAR2(80),
    telefono     NUMBER(10)
);

ALTER TABLE tecnico ADD CONSTRAINT tecnico_pk PRIMARY KEY ( rut_tecnico );


CREATE TABLE empleado (
    rut_empleado  VARCHAR2(15) NOT NULL,
    nombre        VARCHAR2(50) NOT NULL,
    apellido      VARCHAR2(50) NOT NULL,
    correo        VARCHAR2(80) NOT NULL,
    direccion     VARCHAR2(80),
    telefono      NUMBER(10),
    cargo         VARCHAR2(50) NOT NULL,
    departamento  VARCHAR2(50) NOT NULL
);

ALTER TABLE empleado ADD CONSTRAINT empleado_pk PRIMARY KEY ( rut_empleado );

CREATE TABLE servicio (
    id         INTEGER NOT NULL,
    fecha_servicio      DATE NOT NULL,
    direccion_servicio  VARCHAR2(80) NOT NULL,
    tipo_servicio       VARCHAR2(50) NOT NULL,
    detalle_servicio    VARCHAR2(150) NOT NULL,
    rut_tecnico         VARCHAR2(15) NOT NULL,
    rut_cliente         VARCHAR2(15) NOT NULL
);

ALTER TABLE servicio ADD CONSTRAINT servicio_pk PRIMARY KEY ( id );


CREATE TABLE venta (
    id      INTEGER NOT NULL,
    fecha_venta   DATE NOT NULL,
     total      NUMBER(10) NOT NULL,
    rut_cliente   VARCHAR2(15) NOT NULL,
    rut_empleado  VARCHAR2(15) NOT NULL
);

ALTER TABLE venta ADD CONSTRAINT venta_pk PRIMARY KEY ( id );

CREATE TABLE pago (
    id         INTEGER NOT NULL,
    total      NUMBER(10) NOT NULL,
    venta_id   INTEGER NOT NULL
);
ALTER TABLE pago ADD CONSTRAINT pago_pk PRIMARY KEY ( id );

CREATE UNIQUE INDEX pago__idx ON
    pago (
        venta_id
    ASC );

CREATE TABLE libro (
    id   INTEGER NOT NULL,
    nombre     VARCHAR2(50) NOT NULL,
    autor      VARCHAR2(50) NOT NULL,
    editorial  VARCHAR2(50) NOT NULL,
    precio     NUMBER(10) NOT NULL,
    stock      NUMBER(10) NOT NULL,
    proveedor  VARCHAR2(50) NOT NULL
);

ALTER TABLE libro ADD CONSTRAINT libro_pk PRIMARY KEY ( id );

CREATE TABLE carrito (
    id        INTEGER NOT NULL,
    libro_id  INTEGER NOT NULL,
    cantidad  NUMBER(10) NOT NULL
);

ALTER TABLE carrito ADD CONSTRAINT carrito_pk PRIMARY KEY ( id );

CREATE TABLE detalle_venta (
	id  INTEGER NOT NULL,
    venta_venta_id  INTEGER NOT NULL,
    venta_libro_id  INTEGER NOT NULL
);

ALTER TABLE detalle_venta ADD CONSTRAINT detalle_pk PRIMARY KEY ( id);

ALTER TABLE carrito
    ADD CONSTRAINT carrito_libro_fk FOREIGN KEY ( libro_id )
        REFERENCES libro ( id );

ALTER TABLE pago
    ADD CONSTRAINT pago_venta_fk FOREIGN KEY ( venta_id )
        REFERENCES venta ( id );

ALTER TABLE servicio
    ADD CONSTRAINT servicio_cliente_fk FOREIGN KEY ( rut_cliente )
        REFERENCES cliente ( rut_cliente );

ALTER TABLE servicio
    ADD CONSTRAINT servicio_tecnico_fk FOREIGN KEY ( rut_tecnico )
        REFERENCES tecnico ( rut_tecnico );

ALTER TABLE venta
    ADD CONSTRAINT venta_cliente_fk FOREIGN KEY ( rut_cliente )
        REFERENCES cliente ( rut_cliente );

ALTER TABLE venta
    ADD CONSTRAINT venta_empleado_fk FOREIGN KEY ( rut_empleado )
        REFERENCES empleado ( rut_empleado );

ALTER TABLE detalle_venta
    ADD CONSTRAINT venta_fk FOREIGN KEY ( venta_venta_id )
        REFERENCES venta ( id );

ALTER TABLE detalle_venta
    ADD CONSTRAINT venta_libro_fk FOREIGN KEY ( venta_libro_id )
        REFERENCES libro ( id );

